# Guia Moteis API

Este projeto Ã© uma API desenvolvida em **.NET** com **Entity Framework Core**, **JWT para autenticaÃ§Ã£o** e **SQLite/SQL Server** como banco de dados.

## ğŸ“Œ Requisitos
Antes de rodar o projeto, certifique-se de ter os seguintes itens instalados:

- [.NET SDK 7.0+](https://dotnet.microsoft.com/en-us/download)
- [SQLite](https://www.sqlite.org/download.html) ou SQL Server (se em produÃ§Ã£o)
- [Postman](https://www.postman.com/) (opcional, para testar os endpoints)
- [Git](https://git-scm.com/)

## ğŸš€ ConfiguraÃ§Ã£o do Ambiente

### 1ï¸âƒ£ Clonar o repositÃ³rio
```bash
git clone https://github.com/seu-usuario/GuiaMoteisApi.git
cd GuiaMoteisApi
```

### 2ï¸âƒ£ Configurar variÃ¡veis de ambiente
Crie um arquivo **appsettings.Development.json** e configure a conexÃ£o com o banco:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=guia_moteis.db"
  },
  "JwtSettings": {
    "Secret": "SUA_CHAVE_SECRETA_AQUI",
    "Issuer": "GuiaMoteisAPI",
    "Audience": "GuiaMoteisClients"
  }
}
```

### 3ï¸âƒ£ Instalar dependÃªncias
```bash
dotnet restore
```

### 4ï¸âƒ£ Rodar as migraÃ§Ãµes do banco
```bash
dotnet ef database update
```
Se precisar resetar as migraÃ§Ãµes:
```bash
dotnet ef migrations remove
```
Depois, gere uma nova:
```bash
dotnet ef migrations add InitialCreate
```
E aplique novamente:
```bash
dotnet ef database update
```

## â–¶ï¸ Rodando o Projeto
```bash
dotnet run
```
A API estarÃ¡ disponÃ­vel em **http://localhost:5000**.

## ğŸ›  Testando no Swagger
Acesse **http://localhost:5000/swagger** para visualizar e testar os endpoints da API.

Se o Swagger nÃ£o carregar, certifique-se de que o middleware estÃ¡ habilitado no `Program.cs`:
```csharp
app.UseSwagger();
app.UseSwaggerUI(c =>
{
    c.SwaggerEndpoint("/swagger/v1/swagger.json", "Guia Moteis API v1");
});
```

## ğŸ”‘ AutenticaÃ§Ã£o JWT
### Criar usuÃ¡rio
FaÃ§a um **POST** para `/api/auth/register` com um JSON como:
```json
{
  "email": "usuario@email.com",
  "password": "SenhaForte123!"
}
```

### Fazer login
POST para `/api/auth/login`:
```json
{
  "email": "usuario@email.com",
  "password": "SenhaForte123!"
}
```
Ele retornarÃ¡ um token JWT, que deve ser enviado no **Authorization Header** nas prÃ³ximas requisiÃ§Ãµes:
```
Authorization: Bearer SEU_TOKEN_AQUI
```

## ğŸ“Š Endpoint de Faturamento Mensal
Para obter o faturamento mensal, faÃ§a um **GET** para:
```http
GET /api/reservations/faturamento-mensal?year=2024&month=2
```
**Resposta:**
```json
{
  "year": 2024,
  "month": 2,
  "revenue": 50000.00
}
```
Esse endpoint utiliza **cache** para otimizar consultas repetidas e sÃ³ recalcula o valor apÃ³s 10 minutos.

## ğŸ“Š Endpoint de consulta de reservas por perÃ­odo
Para obter o faturamento mensal, faÃ§a um **GET** para:
```http
GET /api/reservations?startDate=2024-02-01&endDate=2024-02-10
```
**Resposta:**
```json
{
	"totalRecords": 1000,
	"pageNumber": 1,
	"pageSize": 10,
	"totalPages": 100,
	"data": [
		{
			"id": 1,
			"checkIn": "2025-03-09T14:50:03.284834",
			"checkout": "2025-03-10T14:50:03.284834",
			"total": 299.0,
			"customerId": 46,
			"customer": {
				"id": 46,
				"name": "Davi Lucca Melo",
				"phone": "(02) 76001-5075",
				"email": "Caio.Batista23@yahoo.com"
			}
        }
    ]
}
```

## ğŸ— Estrutura do Projeto
```
GuiaMoteisApi/
â”‚â”€â”€ Controllers/        # LÃ³gica dos endpoints
â”‚â”€â”€ Models/            # DefiniÃ§Ã£o dos modelos de dados
â”‚â”€â”€ Services/          # ServiÃ§os auxiliares
â”‚â”€â”€ Data/              # ConfiguraÃ§Ã£o do banco e seed de dados
â”‚â”€â”€ Program.cs         # ConfiguraÃ§Ã£o principal da aplicaÃ§Ã£o
â”‚â”€â”€ appsettings.json   # ConfiguraÃ§Ã£o da aplicaÃ§Ã£o
â”‚â”€â”€ README.md          # InstruÃ§Ãµes do projeto
```

## ğŸ“Œ Melhorias Futuras
- ğŸ“Œ Implementar cache para otimizar consultas.
- ğŸ“Œ Melhorar logs e monitoramento com OpenTelemetry.
- ğŸ“Œ Criar testes automatizados para os endpoints.

## ğŸ“„ LicenÃ§a
Este projeto estÃ¡ licenciado sob a **MIT License**.

